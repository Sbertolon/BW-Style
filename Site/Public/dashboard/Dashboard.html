<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BW Style - Dashboard</title>
    <link rel="stylesheet" type="text/css" href="../css/Dashboard.css">
    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/3f0399636b.js" crossorigin="anonymous"></script>
    <script src="../js/funcoes.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
</head>

<body onload="obterDadosGrafico()",idade()>

    <header class="cabecalho">
        <img class="img" src="../assets/2.png" alt="">
        <a class="cabecalho-opcoes-botoes" href="Glowup.html">Glow up</a>
        <a class="cabecalho-opcoes-botoes" href="Look.html">Look</a>
        <a class="cabecalho-opcoes-botoes" href="./dashboard/Dashboard.html">Dashboard</a>

    </header>
    <main class="conteudo" id="conteudo"></main>


    <p><b>Analise de Usuários</b></p>

    <div class="grafico-tudo">

        <div class="grafico">
            <a>Idade dos usuários</a>
            <canvas id="myChart1"></canvas>
        </div>

        <div class="grafico-pizza">
            <a>Usuários que conhecem do assunto</a>
            <canvas id="myChart2"></canvas>
        </div>

        <div class="grafico">
            <a>Número de curtida das postagens</a>
            <canvas id="myChart3"></canvas>
        </div>
    </div>


</body>

</html>
<script>

    let proximaAtualizacao;


 // grafico dois, com conhecimento dos usuários
    function obterDadosGrafico() {

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }


        fetch(`/medidas/ultimas/`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGrafico(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Esta função *plotarGrafico* usa os dados capturados na função anterior para criar o gráfico
    // Configura o gráfico (cores, tipo, etc), materializa-o na página e, 
    // A função *plotarGrafico* também invoca a função *atualizarGrafico*
    function plotarGrafico(resposta) {
        console.log('iniciando plotagem do gráfico...');

        var dados = {
            labels: [],
            datasets: [
                {
                    label: '',
                    data: []
                },
                {
                    yAxisID: 'y-totalpersonagens',
                    label: 'conhecimento dos usuários',
                    fill: true,
                    data: []
                }
            ],
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.labels.push(registro.conhecimento);
            dados.datasets[0].data.push(registro.conhecimento);
            dados.datasets[1].data.push(registro.voto);
            console.log(registro.conhecimento);
        }

        var conhecimentoSim = "Sim";
        var conhecimentoNao = "Não";

        console.log(JSON.stringify(dados));

        const ctx = document.getElementById('myChart2');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [conhecimentoSim, conhecimentoNao],
                datasets: [{
                    label: 'Conhecimento',
                    data: [dados.datasets[1].data[0], dados.datasets[1].data[1], 0.000000001],
                    borderWidth: 1,
                }]
            },
            options: {
                scales: {
                    y: {
                        ticks: {
                            min: 0,
                            max: 15
                        }
                    }
                }
            }
        });
    }



//  // grafico 1
//     function obterDadosGrafico() {

// if (proximaAtualizacao != undefined) {
//     clearTimeout(proximaAtualizacao);
// }


// fetch(`/medidas/idade/`, { cache: 'no-store' }).then(function (response) {
//     if (response.ok) {
//         response.json().then(function (resposta) {
//             console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
//             plotarGrafico(resposta);

//         });
//     } else {
//         console.error('Nenhum dado encontrado ou erro na API');
//     }
// })
//     .catch(function (error) {
//         console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
//     });
// }

// function plotarGrafico(resposta) {
// console.log('iniciando plotagem do gráfico...');

// var dados = {
//     labels: [],
//     datasets: [
//         {
//             label: '',
//             data: []
//         },
//         {
//             yAxisID: 'y-totalpersonagens',
//             label: 'Número de usuário com determinada idade',
//             fill: true,
//             data: []
//         }
//     ],
// };

// for (i = 0; i < resposta.length; i++) {
//     var registro = resposta[i];
//     dados.labels.push(registro.conhecimento);
//     dados.datasets[0].data.push(registro.conhecimento);
//     dados.datasets[1].data.push(registro.voto);
//     console.log(registro.conhecimento);
// }

// var conhecimentoSim = "Sim";
// var conhecimentoNao = "Não";

// console.log(JSON.stringify(dados));

// const ctx = document.getElementById('myChart1');

// new Chart(ctx, {
//     type: 'line',
//     data: {
//         labels: [conhecimentoSim, conhecimentoNao],
//         datasets: [{
//             label: 'Idade',
//             data: [dados.datasets[1].data[0], dados.datasets[1].data[1], 0.000000001],
//             borderWidth: 1,
//         }]
//     },
//     options: {
//         scales: {
//             y: {
//                 ticks: {
//                     min: 0,
//                     max: 15
//                 }
//             }
//         }
//     }
// });
// }

  
</script>